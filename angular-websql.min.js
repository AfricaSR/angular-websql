/**
 * angular-websql
 * Helps you generate and run websql queries with angular services.
 * Â© MIT License
 */
"use strict";angular.module("angular-websql",[]).factory("$webSql",[function(){return{openDatabase:function(a,b,c,d){try{var e=openDatabase(a,b,c,d);if("undefined"==typeof openDatabase)throw"Browser does not support web sql";return{executeQuery:function(a,b){return e.transaction(function(c){c.executeSql(a,[],function(a,c){b&&b(c)})}),this},insert:function(a,b,c){var d="INSERT INTO `{tableName}` ({fields}) VALUES({values}); ",e="",f="";for(var g in b)e+=Object.keys(b)[Object.keys(b).length-1]==g?"`"+g+"`":"`"+g+"`, ",f+=Object.keys(b)[Object.keys(b).length-1]==g?"'"+b[g]+"'":"'"+b[g]+"', ";return this.executeQuery(this.replace(d,{"{tableName}":a,"{fields}":e,"{values}":f}),c),this},update:function(a,b,c,d){var e="UPDATE `{tableName}` SET {update} WHERE {where}; ",f="";for(var g in b)f+="`"+g+"`='"+b[g]+"'";var h=this.whereClause(c);return this.executeQuery(this.replace(e,{"{tableName}":a,"{update}":f,"{where}":h}),d),this},del:function(a,b,c){var d="DELETE FROM `{tableName}` WHERE {where}; ",e=this.whereClause(b);return this.executeQuery(this.replace(d,{"{tableName}":a,"{where}":e}),c),this},select:function(a,b,c){var d="SELECT * FROM `{tableName}` WHERE {where}; ",e=this.whereClause(b);return this.executeQuery(this.replace(d,{"{tableName}":a,"{where}":e}),c),this},selectAll:function(a,b){return this.executeQuery("SELECT * FROM `"+a+"`; ",b),this},whereClause:function(a){var c="";for(var d in a)c+="object"==typeof a[d]?"undefined"==typeof a[d].union?"string"==typeof a[d].value&&a[d].value.match(/NULL/gi)?"`"+d+"` "+a[d].value:"`"+d+"` "+a[d].operator+" '"+a[d].value+"'":"string"==typeof a[d].value&&a[d].value.match(/NULL/gi)?"`"+d+"` "+a[d].value+" "+a[d].union+" ":"`"+d+"` "+a[d].operator+" '"+a[d].value+"' "+a[d].union+" ":"string"==typeof a[d]&&a[d].match(/NULL/gi)?"`"+d+"` "+a[d]:"`"+d+"`='"+a[d]+"'";return c},replace:function(a,b){for(var d in b)a=a.replace(new RegExp(d,"ig"),b[d]);return a},createTable:function(a,b,c){var d="CREATE TABLE IF NOT EXISTS `{tableName}` ({fields}); ",e=[],f="";for(var g in b){var h="{type} {null}";f+="`"+g+"` ","undefined"==typeof b[g]["null"]&&(b[g]["null"]="NULL");for(var i in b[g])h=h.replace(new RegExp("{"+i+"}","ig"),b[g][i]);f+=h,"undefined"!=typeof b[g]["default"]&&(f+=" DEFAULT "+b[g]["default"]),"undefined"!=typeof b[g].primary&&(f+=" PRIMARY KEY"),"undefined"!=typeof b[g].auto_increment&&(f+=" AUTOINCREMENT"),Object.keys(b)[Object.keys(b).length-1]!=g&&(f+=","),"undefined"!=typeof b[g].primary&&b[g].primary&&e.push(g)}var j={tableName:a,fields:f};for(var k in j)d=d.replace(new RegExp("{"+k+"}","ig"),j[k]);return console.log(d),this.executeQuery(d,c),this},dropTable:function(a,b){return this.executeQuery("DROP TABLE IF EXISTS `"+a+"`; ",b),this}}}catch(f){console.error(f)}}}}]);